---
title: "Computer Assignment 1"
author:
  - "Ville Sebastian Olsson (19911231-1999)"
  - "Arvind Guruprasad (19990212-6938)"
date: "`r Sys.Date()`"
output:
  html_document:
    fig_caption: true
  pdf_document:
    fig_caption: true
---

```{r, echo=FALSE, results='hide', fig.show='hide'}
source("assignment1a.R")
list2env(ass1a, envir = .GlobalEnv)
knitr::opts_chunk$set(echo = FALSE, comment = "")
```

# Exercise 1:1

## 1. Percentages in favor and against legal abortion

We have a two-way contingency table with two categorical variables.
Let \(X\) denote the subject's gender, where \(X=1\) indicates a woman
and \(X=2\) indicates a man. Let \(Y\) denote the subject's opinion on
legal abortion, where \(Y=1\) indicates being in favor and \(Y=2\) indicates
being against.
Let \(n_{ij}\) denote the observed cell count in category \(X=i\), \(Y=j\).

The percentage is calculated as the number of subjects in a category
divided by the total number of subjects in the same row.
So for example:
\[\pi_{1|1} = \frac{n_{11}}{n_{1+}} = \frac{309}{500}=0.618\]
Numerically computed percentages:
```{r}
percentages
```

## 2. Different opinions on legal abortion?
Let:
\[\pi_{ij} = P(X=i,Y=j)\]
\[\pi_{i+}=P(X=i)\]
\[\pi_{+j}=P(Y=j)\]

### Hypotheses
We wish to investigate whether men and women have different opinions on legal
abortion.
This means investigating whether the events \(X=i\) and \(Y=j\) are independent
for all \(i,j\). As null hypothesis, we assume that they are independent:
\[H_0: \forall i,j\in\{1,2\}: \pi_{ij}=\pi_{i+}\pi_{+j}\]
Alternative hypothesis:
\[H_1: \exists i,j\in\{1,2\}: \pi_{ij} \neq \pi_{i+}\pi_{+j}\]

### Pearson's statistic
Let \(N_{ij}\) denote the random variable which \(n_{ij}\) is a realization of.

Pearson's \(\chi^2\) statistic is given by:
\[T_{\chi^2} = \sum_{i,j\in\{1,2\}} \frac{(N_{ij}-\hat\mu_{ij})^2}{\hat\mu_{ij}}\]
where \(\hat\mu_j\) is an estimate of the expected frequency for category \(j\), given by:
\[\hat\mu_{ij} = n\hat\pi_{ij} = n \hat\pi_{i+}\hat\pi_{+j} = n\frac{n_{i+}}{n}\frac{n_{+j}}{n}=\frac{n_{i+}n_{+j}}{n}\]
Estimates:
\[\hat\mu_{11} = \frac{500\cdot 628}{1100}=\frac{3140}{11}\]
\[\hat\mu_{12} = \frac{500\cdot 472}{1100}=\frac{2360}{11}\]
\[\hat\mu_{12} = \frac{600\cdot 628}{1100}=\frac{3768}{11}\]
\[\hat\mu_{12} = \frac{600\cdot 472}{1100}=\frac{2832}{11}\]
The statistic is, under \(H_0\), asymptotically \(\chi^2\) distributed with \(p-q = 3-2 = 1\)
degree of freedom, where \(p\) is the number of parameters in the unrestricted model
and \(q\) is the number of free parameters under \(H_0\).

Realization of Pearson's statistic:
\[t_{\chi^2} =
\frac{(309-\frac{3140}{11})^2}{3140/11}+
\frac{(191-\frac{2360}{11})^2}{2360/11}+
\frac{(319-\frac{3768}{11})^2}{3768/11}+
\frac{(281-\frac{2832}{11})^2}{2832/11}
\]

### LR statistic
The likelihood ratio (LR) statistic is given by:
\[T_{LR} = 2\sum_{i,j\in\{1,2\}} N_{ij}\ln\frac{N_{ij}}{\hat\mu_{ij}}\]
Like Person's statistic, the LR statistic is asymptotically \(\chi^2(1)\)
distributed under \(H_0\).

Realization of the LR statistic:
\[t_{LR} = 2\left(
309\cdot\ln\frac{309}{3140/11}+
191\cdot\ln\frac{191}{2360/11}+
319\cdot\ln\frac{319}{3768/11}+
281\cdot\ln\frac{281}{2832/11}
\right)\]

### Result

Numerically computed realizations of the \(\chi^2\) statistic and LR statistic:
```{r}
square_statistics
```

### Conclusion

The P-value for Pearson's \(\chi^2\) statistic is
approximately \(0.0040\) which is between significance levels \(0.001\) and
\(0.01\). Hence, we reject \(H_0\) in favor of \(H_1\) with high significance.

The P-value for the LR statistic is
approximately \(0.0039\) which is between significance levels \(0.001\) and
\(0.01\). Hence, we reject \(H_0\) in favor of \(H_1\) with high significance.

In conclusion, men and women differ in their opinions on legal abortion.

## 3. Odds ratio

### Odds
We are interested in comparing the odds of a woman being in favor of legal
abortion with the odds of a man being in favor of it.
Hence, we want to find the probabilities of \(Y\) conditioned on \(X\).

Odds for women:
\[\omega_1 = \frac{P(Y=1|X=1)}{P(Y=2|X=1)} = \frac{P(X=1,Y=1)/P(X=1)}{P(X=1,Y=2)/P(X=1)}=\frac{P(X=1,Y=1)}{P(X=1,Y=2)}
=\frac{\pi_{11}}{\pi_{12}}=\frac{N_{11}/n}{N_{12}/n}=\frac{N_{11}}{N_{12}}\]
Odds for men:
\[\omega_2 = \frac{P(Y=1|X=2)}{P(Y=2|X=2)} = \frac{P(X=2,Y=1)/P(X=2)}{P(X=2,Y=2)/P(X=2)}=\frac{P(X=2,Y=1)}{P(X=2,Y=2)}
=\frac{\pi_{21}}{\pi_{22}}=\frac{N_{21}/n}{N_{22}/n}=\frac{N_{21}}{N_{22}}\]
Odds ratio:
\[
\theta = \frac{\omega_1}{\omega_2}
= \frac{\pi_{11}/\pi_{12}}{\pi_{21}/\pi_{22}}
= \frac{\pi_{11}\pi_{22}}{\pi_{12}\pi_{21}}
\]
Estimated odds ratio:
\[
\hat\theta = \frac{\hat\omega_1}{\hat\omega_2}
= \frac{\hat\pi_{11}\hat\pi_{22}}{\hat\pi_{12}\hat\pi_{21}}
= \frac{(n_{11}/n)(n_{22}/n)}{(n_{12}/n)(n_{21}/n)}
= \frac{n_{11}n_{22}}{n_{12}n_{21}}
= \frac{309\cdot 281}{191 \cdot 319}
= \frac{86829}{60929}
\approx 1.43
\]

### Confidence interval

We start by constructing a confidence interval for the log-transformed odds
ratio:
\[\operatorname{CI}_{\ln\theta} = \left[\ln \hat\theta - z_{0.95} \operatorname{se}(\ln \hat\theta ),\ln \hat\theta  + z_{0.95} \operatorname{se}(\ln \hat\theta )\right]\]
with standard error:
\[\operatorname{se}(\ln\hat\theta)
= \sqrt{\widehat{\operatorname{Var}}(\ln\hat\theta)}
= \sqrt{\frac{1}{n_{11}}+\frac{1}{n_{12}}+\frac{1}{n_{21}}+\frac{1}{n_{22}}}
= \sqrt{\frac{1}{309}+\frac{1}{191}+\frac{1}{319}+\frac{1}{281}}
\approx 0.1231
\]
Realized confidence interval for \(\ln \theta\):
\[\operatorname{CI}_{\ln\theta}
\approx\left[\ln\frac{86829}{60929} - 1.96 \cdot 0.1231,\ln\frac{86829}{60929} + 1.96\cdot 0.1231\right]
\approx \left[0.1130,0.5955\right]
\]
We now exponentiate the limits to obtain the confidence interval for \(\theta\):
\[\operatorname{CI}_\theta \approx \left[e^{0.1130},e^{0.5955}\right] \approx [1.12,1.81]\]

### Interpretation
The estimated odds ratio between women and men is approximately 1.43, so
the odds are 43 \% higher for women to be in favor of legal abortion compared
to men.

The 95 % confidence interval for the odds ratio is approximately
\([1.12,1.81]\).
Since the interval does not contain 1, we conclude with 95 % confidence
that the odds of women being in favor of legal abortion are higher than for men.

## 4. Risk ratio

### Relative risk

The "risk" of women and men, respectively, being in favor of legal abortion:
\[r_1 = P(Y=1|X=1) = \frac{P(X=1,Y=1)}{P(X=1)} = \frac{\pi_{11}}{\pi_{1+}}\]
\[r_2 = P(Y=1|X=2) = \frac{P(X=2,Y=1)}{P(X=2)} = \frac{\pi_{21}}{\pi_{2+}}\]

Risk ratio:
\[r = \frac{r_1}{r_2} = \frac{\pi_{11}\pi_{2+}}{\pi_{21}\pi_{1+}}\]

Estimated relative risk:
\[\hat{r} = \frac{n_{11}/n_{1+}}{n_{21}/n_{2+}} = \frac{309/500}{319/600}
=\frac{1854}{1595} \approx 1.16\]

### Confidence interval
We start by constructing a confidence interval for the log-transformed odds
ratio:
\[\operatorname{CI}_{\ln r} = \left[
\ln \hat r - z_{0.95} \operatorname{se}(\ln \hat r ),
\ln \hat r + z_{0.95} \operatorname{se}(\ln \hat r )
\right]\]
with standard error:
\[\operatorname{se}(\ln\hat r)
= \sqrt{\widehat{\operatorname{Var}}(\ln\hat r)}
= \sqrt{\frac{1-n_{11}/n_{1+}}{n_{11}}+\frac{1-n_{21}/n_{2+}}{n_{21}}}
= \sqrt{\frac{1-309/500}{309}+\frac{1-319/600}{319}}
\approx 0.05200
\]
Realized confidence interval for \(\ln r\):
\[\operatorname{CI}_{\ln r}
\approx [\ln\frac{1854}{1596}-1.96\cdot 0.05200,\frac{1854}{1596}+1.96\cdot 0.05200]
\approx [0.04793,0.2518]
\]
We now exponentiate the limits to obtain the confidence interval for \(r\):
\[\operatorname{CI}_r \approx [e^{0.04793},e^{0.2518}] \approx [1.05,1.29]\]

### Interpretation

The estimated risk ratio between women and men is approximately 1.16,
indicating that women are 16 % more likely than men to be in favor of legal
abortion.

The 95 % confidence interval for the risk ratio is approximately
\([1.05,1.29]\).
Since this interval does not contain 1, we conclude with 95 %
confidence that women are more likely to be in favor of legal abortion compared
to men.

## 5. Numerical result

__

# Exercise 1:2

## 1. Analysis of admission data

## 2. Comparison with scaled data

## 3. Custom two-way table

...
