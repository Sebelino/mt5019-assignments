---
title: "Computer Assignment 3"
author:
  - "Ville Sebastian Olsson (19911231-1999)"
  - "Arvind Guruprasad (19990212-6938)"
date: "`r Sys.Date()`"
output:
  html_document:
    fig_caption: true
  pdf_document:
    fig_caption: true
---

```{r, echo=FALSE, results='hide', fig.show='hide'}
source("assignment3.R")
list2env(ass, envir = .GlobalEnv)
knitr::opts_chunk$set(echo = FALSE, comment = "")
```

# Exercise 3:1

## 1. Model selection

The data comes from a study reported by Wermuth (1976), which was collected in a birth clinic. The dataset includes the following variables:

- **Mother's age (X):** `<30` and `30+`.
- **Smoking habits (Y):** `<5 cigarettes/day` and `5+ cigarettes/day`.
- **Gestational age (Z):** `<260 days` and `â‰¥260 days`.
- **Child survival (V):** Binary outcome indicating survival (Yes/No).

The goal is to build log-linear models to understand the associations between these categorical variables.

To generate a table, we follow this process:

1. Read the CSV data.
2. Fit the saturated model, \(XYZV\).
3. For each combination of interaction terms, fit a model. Each combination must include the main effects, i.e. \(X\), \(Y\), \(Z\) and \(V\).
4. For each sub-model, calculate deviance, Akaike's information criterion (AIC) and p-value with respect to the saturated model.

The deviance is used to calculate the p-value as follows:
\[\text{p-value} = P(\chi^2_{\text{df}} \geq T_{\chi^2})\]
where \(T_{\chi^2} = 2(\ell(XYZ) - \ell(M))\) denotes the deviance and \(\text{df}\)
is the degrees of freedom. \(\ell(M)\) denotes the log-likelihood under model \(M\).

The degrees of freedom is calculated as:
\[\text{df} = IJKL - \text{number of parameters of }M\]
where \(IJKL = 2\cdot2\cdot2\cdot2 = 16\) is the number of cells in the contingency table.

The AIC is calculated as:
\[\text{AIC} = -2\ell(\hat\theta) + 2p\]
TODO: Explain \(p\)

Result:
```{r}
model_table
```
TODO: Ask about whether to list all combinations of interaction terms vs. total ordering of models, where set n is a subset of set n-1

## 2.

The table contains the following information which helps us
select the best model:

**1. Deviance**

- Measures the difference in goodness-of-fit between the submodel and the saturated model.
- A low deviance indicates a good fit.

**2. Degrees of Freedom**

- Reflects the number of parameters removed from the saturated model.
- Higher df means a simpler model.

**3. p-value**

- Tests whether the submodel is significantly worse than the saturated model.
- If \( p > 0.05 \), the simpler model is adequate.

**4. AIC**

- Evaluates the trade-off between model complexity and fit.
- Select the model with the lowest AIC.

```{r}
model_table[order(model_table$AIC),]
```

The table above has been sorted by AIC in ascending order,
to gauge which of the simpler model would be effective with
respect to the saturated model.

We should select the model that satisfies two criteria:

* Minimal AIC value
* The p-value is greater than 0.05

Based on the table above, we want to select model 6,
which includes the interaction terms `XV, YV, ZV, XZ, XY, YZ`.

# 3.

The model we selected looks like this:

```{r}
best_model
```

Given the lack of three-way interactions, this model
is much simpler relative to the relative model and the
other three-way interaction model while retaining
its ability to fit the data reasonably well.

```{r}
associations
```

\[OR_Y = \frac{odds(Y=1)}{odds(Y=0)}\]

Critical Factors:

- **The main effects of \( Y \) (smoking) and \( Z \) (gestational age)** are significant predictors of child survival.
- **The interaction \( V : Z \) (child survival and gestational age)** has the strongest effect, highlighting the importance of adequate gestational periods for child survival.

Non-significant Effects:

- The interactions \( V : Y \), \( X : Z \), and \( Y : Z \) are not statistically significant, suggesting these effects are not strong enough to influence survival outcomes in this dataset.

Implications:

- Reducing smoking among mothers and improving gestational age outcomes are likely to have the most significant positive impact on child survival rates.


# 4.

```{r}
model_table4
```

Based on the table, AIC is minimized for the model `X, Y, Z`
(AIC: `1092.757`),
so we consider it the model that strikes the best balance
between goodness-of-fit and model complexity.

Next, we calculate the odds ratio and associated confidence intervals
and p-values of this model's coefficients:

```{r}
results4
```

The odds ratio for the smoking risk factor (`y5+`) indicates that mothers
who smoke 5+ cigarettes per day
have 65.5% of the odds of child survival compared to mothers who smoke less
than 5 cigarettes per day, holding all other variables constant.
Since the odds ratio is less than 1, it suggests a negative association between smoking heavily and child survival.

# 5.

```{r}
coefficients <- summary(model4)$coefficients
beta <- coefficients[, "Estimate"]
se <- coefficients[, "Std. Error"]
print(beta)
#print(se)
```


```{r}
coefficients <- summary(model4_loglinear)$coefficients
beta <- coefficients[, "Estimate"]
se <- coefficients[, "Std. Error"]
print(beta)
#print(se)
```


